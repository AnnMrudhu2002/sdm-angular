<div class="card profile-card shadow-lg border-0 rounded-4">
  <div class="card-header text-dark rounded-top-4">
    <h4 class="m-0 fw-bold">Student Profile</h4>
  </div>
  <form [formGroup]="profileForm" (ngSubmit)="submitProfile()" class="p-4 border rounded bg-light shadow-sm">
    <div class="row g-3 mb-3">
      <!-- DOB -->
      <div class="col-md-3">
        <label>DOB<span class="text-danger">*</span></label>
        <input type="date" formControlName="dob" class="form-control"
          [ngClass]="{ 'is-invalid': profileForm.get('dob')?.invalid && profileForm.get('dob')?.touched }"
          [max]="today"/>
        <div class="invalid-feedback" *ngIf="profileForm.get('dob')?.touched && profileForm.get('dob')?.errors">
          <div *ngIf="profileForm.get('dob')?.errors?.['required']">Date of Birth is required</div>
          <div *ngIf="profileForm.get('dob')?.errors?.['futureDate']">Date of Birth must be before today</div>
        </div>
      </div>

      <!-- Gender -->
      <div class="col-md-3">
        <label>Gender<span class="text-danger">*</span></label>
        <select formControlName="genderId" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('genderId')?.invalid && profileForm.get('genderId')?.touched }">
          <option value="0" disabled>Select Gender</option>
          <option *ngFor="let g of genders" [value]="g.genderId">{{ g.name }}</option>
        </select>
        <div class="invalid-feedback" *ngIf="profileForm.get('genderId')?.touched && profileForm.get('genderId')?.errors">
          Gender is required
        </div>
      </div>
      

      <!-- Phone -->
      <div class="col-md-3">
        <label>Phone<span class="text-danger">*</span></label>
        <input type="text" formControlName="phoneNumber" class="form-control"  (keypress)="allowPhoneInput($event)"
          [ngClass]="{ 'is-invalid': profileForm.get('phoneNumber')?.invalid && profileForm.get('phoneNumber')?.touched }" />
        <div class="invalid-feedback"
          *ngIf="profileForm.get('phoneNumber')?.touched && profileForm.get('phoneNumber')?.errors">
          <div *ngIf="profileForm.get('phoneNumber')?.errors?.['required']">Phone Number is required</div>
          <div *ngIf="profileForm.get('phoneNumber')?.errors?.['pattern']">Invalid phone number</div>
        </div>
      </div>

      <!-- Alternate Phone -->
<div class="col-md-3">
  <label>Alternate Phone</label>
  <input type="text" formControlName="alternatePhoneNumber" class="form-control" (keypress)="allowPhoneInput($event)"
    [ngClass]="{
      'is-invalid':
        (profileForm.get('alternatePhoneNumber')?.invalid && profileForm.get('alternatePhoneNumber')?.touched) ||
        profileForm.errors?.['samePhone']
    }" />
  <div class="invalid-feedback" *ngIf="profileForm.get('alternatePhoneNumber')?.touched && profileForm.get('alternatePhoneNumber')?.errors">
    <div *ngIf="profileForm.get('alternatePhoneNumber')?.errors?.['pattern']">Invalid alternate phone number</div>
  </div>
  <div class="invalid-feedback" *ngIf="profileForm.errors?.['samePhone']">Alternate Phone must be different</div>
</div>
    </div>

    <!-- Address -->
    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label>Address<span class="text-danger">*</span></label>
        <textarea formControlName="address" class="form-control" rows="2"
          [ngClass]="{ 'is-invalid': profileForm.get('address')?.invalid && profileForm.get('address')?.touched }"></textarea>
        <small class="text-muted d-block text-end">
          {{ profileForm.get('address')?.value?.length || 0 }}/300 characters
        </small>

        <div class="invalid-feedback" *ngIf="profileForm.get('address')?.errors?.['required']">
          Address is required
        </div>
        <div class="invalid-feedback" *ngIf="profileForm.get('address')?.errors?.['maxlength']">Address cannot exceed
          300 characters</div>
      </div>

      <div class="col-md-6">
        <label>Permanent Address<span class="text-danger">*</span></label>
        <textarea formControlName="permanentAddress" class="form-control" rows="2"
          [ngClass]="{ 'is-invalid': profileForm.get('permanentAddress')?.invalid && profileForm.get('permanentAddress')?.touched }"></textarea>
        <small class="text-muted d-block text-end">
          {{ profileForm.get('permanentAddress')?.value?.length || 0 }}/300 characters
        </small>

        <div class="invalid-feedback" *ngIf="profileForm.get('permanentAddress')?.errors?.['required']">
          Permanent Address is required
        </div>
        <div class="invalid-feedback" *ngIf="profileForm.get('permanentAddress')?.errors?.['maxlength']">Permanent
          Address cannot exceed 300 characters</div>
      </div>
    </div>

    <!-- State, District, Pincode, City (order fixed) -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <label>State<span class="text-danger">*</span></label>
        <select formControlName="state" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('state')?.invalid && profileForm.get('state')?.touched }">
          <option value="" disabled>Select Sate</option>
          <option *ngFor="let s of states" [value]="s.stateId">{{ s.stateName }}</option>
        </select>
        <div class="invalid-feedback" *ngIf="profileForm.get('state')?.touched && profileForm.get('state')?.errors">
          State is required
        </div>
      </div>

      <div class="col-md-3">
        <label>District<span class="text-danger">*</span></label>
        <select formControlName="district" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('district')?.invalid && profileForm.get('district')?.touched }">
          <option value="" disabled>Select District</option>
          <option *ngFor="let d of districts" [value]="d.districtId">{{ d.districtName }}</option>
        </select>
        <div class="invalid-feedback"
          *ngIf="profileForm.get('district')?.touched && profileForm.get('district')?.errors">
          District is required
        </div>
      </div>

      <div class="col-md-3">
        <label>Pincode<span class="text-danger">*</span></label>
        <select formControlName="pincode" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('pincode')?.invalid && profileForm.get('pincode')?.touched }"
          (change)="onPincodeChange($event)">
          <option value="" disabled>Select Pincode</option>
          <option *ngFor="let p of pincodes" [value]="p.pincodeId">{{ p.code }}</option>
        </select>
        <div class="invalid-feedback" *ngIf="profileForm.get('pincode')?.touched && profileForm.get('pincode')?.errors">
          Pincode is required
        </div>
      </div>

      <div class="col-md-3">
        <label>City<span class="text-danger">*</span></label>
        <select formControlName="city" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('city')?.invalid && profileForm.get('city')?.touched }">
          <option value="" disabled>Select City</option>
          <option *ngFor="let po of postOffices" [value]="po.officeName">{{ po.officeName }}</option>
        </select>
        <div class="invalid-feedback" *ngIf="profileForm.get('city')?.touched && profileForm.get('city')?.errors">
          City is required
        </div>
      </div>
    </div>

    <!-- Course & ID Proof -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <label>Course<span class="text-danger">*</span></label>
        <select formControlName="courseId" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('courseId')?.invalid && profileForm.get('courseId')?.touched }">
          <option value="0" disabled>Select Course</option>
          <option *ngFor="let c of courses" [value]="c.courseId">{{ c.courseName }}</option>
        </select>
        <div class="invalid-feedback"
          *ngIf="profileForm.get('courseId')?.touched && profileForm.get('courseId')?.errors">
          Course is required
        </div>
      </div>

      <div class="col-md-3">
        <label>ID Proof Type<span class="text-danger">*</span></label>
        <select formControlName="idProofTypeId" class="form-select"
          [ngClass]="{ 'is-invalid': profileForm.get('idProofTypeId')?.invalid && profileForm.get('idProofTypeId')?.touched }">
          <option value="0" disabled>Select ID Proof</option>
          <option *ngFor="let id of idProofTypes" [value]="id.idProofTypeId">{{ id.typeName }}</option>
        </select>
        <div class="invalid-feedback"
          *ngIf="profileForm.get('idProofTypeId')?.touched && profileForm.get('idProofTypeId')?.errors">
          ID Proof Type is required
        </div>
      </div>

      <!-- ID Proof Number -->
<div class="col-md-3">
  <label>ID Proof Number<span class="text-danger">*</span></label>
  <input type="text" formControlName="idProofNumber" class="form-control"
    [ngClass]="{ 'is-invalid': profileForm.get('idProofNumber')?.invalid && profileForm.get('idProofNumber')?.touched }" />
    <div class="invalid-feedback" *ngIf="profileForm.get('idProofNumber')?.touched && profileForm.get('idProofNumber')?.errors">
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['required']">
        ID Proof Number is required
      </div>
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['maxlength']">
        Maximum 50 characters allowed
      </div>
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['invalidAadhar']">
        Aadhar must be 12 digits
      </div>
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['invalidPAN']">
        PAN format invalid (ABCDE1234F)
      </div>
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['invalidDL']">
        Driver's License invalid (6â€“15 alphanumeric)
      </div>
      <div *ngIf="profileForm.get('idProofNumber')?.errors?.['invalidVoter']">
        Voter ID invalid (10 alphanumeric)
      </div>
    </div>
</div>
    </div>

    <!-- Buttons -->
    <div class="d-flex justify-content-end mt-3 gap-2">
      <!-- Save -->
      <button type="button" class="btn btn-primary"
              [disabled]="!canSave()"
              (click)="submitProfile()">
        Save
      </button>
    
      <!-- Next -->
      <button type="button" class="btn btn-success"
              [disabled]="!canNext()"
              (click)="goNext()">
        Next
      </button>
    </div>
  </form>

</div>